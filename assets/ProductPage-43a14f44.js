import{h as S,d as k,m as oe,r as n,o as g,c as T,w as a,a as e,f,j as s,E as ne,n as le,i as y,p as ae,q as se,b as x,F as A,l as ie,t as F,u as D,s as L,v as ce,k as N,e as de,x as re,y as ue,_ as _e}from"./index-fccdf61c.js";import{u as pe}from"./useStore-9ef4082a.js";import{_ as me}from"./MediaLayout.vue_vue_type_script_setup_true_lang-09ff307f.js";import{u as j,a as ve}from"./useQuery-67dc28bd.js";const fe=l=>S.get(`/products?page=${l}`).then(o=>o.data),ge=l=>S.post("/products",l).then(o=>o.data),be=l=>S.put(`/products/${l.id}`,l).then(o=>o.data),he=l=>S.delete(`/products/${l}`).then(o=>o.data),ye=()=>S.get("/product-categories").then(l=>l.data),Ve=()=>({ruleRequired:(l,o,p)=>{let c="Required";return p?c=p:o&&(c=`${`${o} is required`}`),!!l||c}}),Ce={class:"pa-4"},xe={class:"float-right"},$e=k({__name:"MediaModal",props:{isOpen:{type:Boolean,default:!1},onSave:{type:Function,required:!0}},emits:["onClose"],setup(l,{emit:o}){const p=l,c=pe("media"),u=oe(()=>c.getters(ne.GET_SELECTED_FILES)),_=()=>{p.onSave([...u.value]),m()},m=()=>{c.dispatch(le.HANDLE_SET_SELECTED_FILES,new Set),o("onClose")};return(v,t)=>{const V=n("v-card-title"),h=n("VDivider"),b=n("v-btn"),C=n("v-card"),$=n("v-dialog");return g(),T($,{"model-value":l.isOpen,width:900,persistent:""},{default:a(()=>[e(C,null,{default:a(()=>[e(V,null,{default:a(()=>[f("Select file")]),_:1}),e(h),s("div",Ce,[s("div",null,[e(me,{"is-select-mode":""})]),s("div",xe,[e(b,{class:"mr-2",onClick:m},{default:a(()=>[f(" Cancel ")]),_:1}),e(b,{color:"blue",onClick:_},{default:a(()=>[f(" Save ")]),_:1})])])]),_:1})]),_:1},8,["model-value"])}}}),De={class:"pa-2"},Pe={class:"mb-6"},Se={class:"mb-6 flex justify-between align-center"},ke={key:0},R=k({__name:"ProductEditDialog",props:{isOpenDialog:{type:Boolean,required:!0,default:!1},onCloseDialog:{type:Function,required:!0},product:{type:Object,required:!1,default:null}},setup(l){var C,$,w,P,E,q;const o=l,p=j(),{ruleRequired:c}=Ve(),u=y(!1),_=y(!1),m=y([]),v={name:((C=o==null?void 0:o.product)==null?void 0:C.name)??null,category_id:(($=o==null?void 0:o.product)==null?void 0:$.categoryId)??null,price:((w=o==null?void 0:o.product)==null?void 0:w.price)??null,thumbnail:((P=o==null?void 0:o.product)==null?void 0:P.thumbnail)??null,is_active:!0,short_description:((E=o==null?void 0:o.product)==null?void 0:E.shortDescription)??"",description:((q=o==null?void 0:o.product)==null?void 0:q.description)??"",is_virtual_product:!1},t=ae(v),V=async()=>{try{const{data:d}=await ye();m.value=d.map(({id:i,name:B})=>({value:i,title:B}))}catch{}};se(()=>{V()});const h=async()=>{try{if(u.value=!0,o!=null&&o.product){const d={id:o.product.id,...t};d.short_description||d==null||delete d.short_description,d.description||delete d.description,await be(d)}else{const d=new FormData;d.append("name",t.name??""),t.category_id&&d.append("category_id",t.category_id),t.price&&d.append("price",t.price),t.thumbnail&&d.append("thumbnail",t.thumbnail),t.short_description&&d.append("short_description",t.short_description),t.description&&d.append("description",t.description),await ge(d)}o.onCloseDialog(),b(),p.refetchQueries(["getProducts"])}catch{}finally{u.value=!1}},b=()=>{t.name=v.name,t.category_id=v.category_id,t.price=v.price,t.short_description=v.short_description,t.description=v.description,t.thumbnail=v.thumbnail};return(d,i)=>{const B=n("v-icon"),I=n("v-btn"),Q=n("v-toolbar-title"),z=n("v-spacer"),G=n("v-toolbar-items"),H=n("v-toolbar"),O=n("v-text-field"),U=n("v-textarea"),M=n("v-col"),K=n("v-select"),Y=n("VIcon"),J=n("VImg"),W=n("v-row"),X=n("v-container"),Z=n("v-form"),ee=n("v-card"),te=n("v-dialog");return g(),x(A,null,[e(te,{fullscreen:"",transition:"dialog-bottom-transition",scrim:!1,"model-value":l.isOpenDialog},{default:a(()=>[e(ee,null,{default:a(()=>[e(Z,{onSubmit:ie(h,["prevent"])},{default:a(()=>[e(H,{dark:"",color:"blue"},{default:a(()=>[e(I,{icon:"",dark:"",onClick:l.onCloseDialog,disabled:u.value},{default:a(()=>[e(B,null,{default:a(()=>[f("mdi-close")]),_:1})]),_:1},8,["onClick","disabled"]),e(Q,null,{default:a(()=>[f(F(l.product?"Update product":"Create product"),1)]),_:1}),e(z),e(G,null,{default:a(()=>[e(I,{variant:"text",type:"submit",loading:u.value},{default:a(()=>[f(" Save ")]),_:1},8,["loading"])]),_:1})]),_:1}),s("div",De,[e(X,{fluid:""},{default:a(()=>[e(W,null,{default:a(()=>[e(M,{cols:"12",md:"8"},{default:a(()=>[e(O,{label:"Name",variant:"outlined",modelValue:t.name,"onUpdate:modelValue":i[0]||(i[0]=r=>t.name=r),rules:[D(c)]},null,8,["modelValue","rules"]),e(O,{label:"Price",variant:"outlined",type:"number",modelValue:t.price,"onUpdate:modelValue":i[1]||(i[1]=r=>t.price=r),rules:[D(c)]},null,8,["modelValue","rules"]),e(U,{label:"Short description",variant:"outlined",modelValue:t.short_description,"onUpdate:modelValue":i[2]||(i[2]=r=>t.short_description=r)},null,8,["modelValue"]),e(U,{label:"Description",variant:"outlined",modelValue:t.description,"onUpdate:modelValue":i[3]||(i[3]=r=>t.description=r)},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"4"},{default:a(()=>[e(K,{label:"Category",items:m.value,variant:"outlined",modelValue:t.category_id,"onUpdate:modelValue":i[4]||(i[4]=r=>t.category_id=r),rules:[D(c)]},null,8,["items","modelValue","rules"]),s("div",Pe,[s("div",Se,[e(I,{onClick:i[5]||(i[5]=r=>_.value=!0)},{default:a(()=>[e(Y,{icon:"mdi-paperclip"}),f("Choose Thumbnail ")]),_:1}),t.thumbnail?(g(),T(I,{key:0,icon:"mdi-trash-can-outline",class:"text-red",onClick:i[6]||(i[6]=r=>t.thumbnail=null)})):L("",!0)]),t.thumbnail?(g(),x("div",ke,[e(J,{src:t.thumbnail},null,8,["src"])])):L("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["model-value"]),e($e,{"is-open":_.value,onOnClose:i[7]||(i[7]=r=>_.value=!1),"on-save":r=>{r!=null&&r.length&&(t.thumbnail=r[0])}},null,8,["is-open","on-save"])],64)}}}),we={class:"py-2"},Ee={class:"d-flex"},qe=k({__name:"ProductTableRow",props:{product:{type:Object,required:!0}},setup(l){const o=l,p=j(),c=y(!1),u=y(!1),_=y(!1),m=async()=>{try{_.value=!0,await he(o.product.id),N.success("Delete success"),p.refetchQueries(["getProducts"])}catch{N.error("Error")}finally{c.value=!1,_.value=!1}};return(v,t)=>{const V=n("VImg"),h=n("VIcon"),b=n("VBtn"),C=n("v-card-title"),$=n("v-card-text"),w=n("v-spacer"),P=n("v-btn"),E=n("v-card-actions"),q=n("v-card"),d=n("v-dialog");return g(),x(A,null,[s("tr",null,[s("td",null,F(l.product.categoryId),1),s("td",null,[s("div",we,[e(V,{src:l.product.thumbnail,width:"150"},null,8,["src"])])]),s("td",null,F(l.product.name),1),s("td",null,F(l.product.price),1),s("td",null,[s("div",Ee,[e(b,{color:"orange",class:"mr-2"},{default:a(()=>[e(h,{icon:"mdi-square-edit-outline",onClick:t[0]||(t[0]=i=>u.value=!0)})]),_:1}),e(d,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=i=>c.value=i),persistent:"",width:"auto"},{activator:a(({props:i})=>[e(b,ce({color:"red"},i),{default:a(()=>[e(h,{icon:"mdi-trash-can-outline"})]),_:2},1040)]),default:a(()=>[e(q,null,{default:a(()=>[e(C,{class:"text-h5 text-red-500"},{default:a(()=>[f(" Delete ")]),_:1}),e($,null,{default:a(()=>[f("Do you want to delete this product?")]),_:1}),e(E,null,{default:a(()=>[e(w),e(P,{color:"",variant:"text",onClick:t[1]||(t[1]=i=>c.value=!1),disabled:_.value},{default:a(()=>[f(" No ")]),_:1},8,["disabled"]),e(P,{color:"red",variant:"text",onClick:m,loading:_.value},{default:a(()=>[f(" Yes ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),e(R,{"is-open-dialog":u.value,product:l.product,"on-close-dialog":()=>{u.value=!1}},null,8,["is-open-dialog","product","on-close-dialog"])],64)}}}),Ie=l=>(re("data-v-d0b26c21"),l=l(),ue(),l),Fe=Ie(()=>s("thead",{class:"bg-grey-lighten-4 z-index-1"},[s("tr",null,[s("th",{class:"text-left"},"Category"),s("th",{class:"text-left"},"Thumbnail"),s("th",{class:"text-left"},"Name"),s("th",{class:"text-left"},"Price"),s("th",null,"Action")])],-1)),Te={key:0},Ae={colspan:"5"},Be={class:"text-center my-16"},Le=k({__name:"ProductTable",props:{isLoading:{type:Boolean,required:!0,default:!1},products:{type:Array,required:!0,default:()=>[]}},setup(l){return(o,p)=>{const c=n("v-progress-circular"),u=n("v-table");return g(),T(u,{class:"border","fixed-header":"",height:700,hover:""},{default:a(()=>[Fe,s("tbody",null,[l.isLoading?(g(),x("tr",Te,[s("td",Ae,[s("div",Be,[e(c,{size:50,indeterminate:""})])])])):(g(!0),x(A,{key:1},de(l.products,_=>(g(),T(qe,{key:_,product:_},null,8,["product"]))),128))])]),_:1})}}});const Oe=_e(Le,[["__scopeId","data-v-d0b26c21"]]),Ue={class:"d-flex justify-space-between mb-3"},Me=s("div",{class:"text-h5"},"Products",-1),Ne={key:0,class:"d-flex justify-end mt-2"},Ge=k({__name:"ProductPage",setup(l){const o=y(!1),p=y(!1),c=y(1),{data:u}=ve({queryKey:["getProducts",c.value],queryFn:async()=>await fe(c.value??0)});return(_,m)=>{var V,h,b;const v=n("v-btn"),t=n("VPagination");return g(),x(A,null,[s("div",Ue,[Me,e(v,{onClick:m[0]||(m[0]=()=>{p.value=!0})},{default:a(()=>[f("Create product")]),_:1})]),e(Oe,{products:((V=D(u))==null?void 0:V.data)??[],"is-loading":o.value},null,8,["products","is-loading"]),(h=D(u))!=null&&h.meta.last_page?(g(),x("div",Ne,[e(t,{modelValue:c.value,"onUpdate:modelValue":m[1]||(m[1]=C=>c.value=C),length:(b=D(u))==null?void 0:b.meta.last_page,"total-visible":7,size:40},null,8,["modelValue","length"])])):L("",!0),e(R,{"is-open-dialog":p.value,"on-close-dialog":()=>{p.value=!1}},null,8,["is-open-dialog","on-close-dialog"])],64)}}});export{Ge as default};
