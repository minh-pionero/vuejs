import{u as O}from"./useStore-9ef4082a.js";import{d as R,i as D,m as b,r as m,o as i,c as I,w as y,a,f as L,t as V,j as v,E as S,b as E,F as T,e as F,s as $,n as x,P as q,Z as B,_ as M,q as j}from"./index-fccdf61c.js";const P={class:"pa-4"},z={class:"float-right"},N=R({__name:"MediaRenameDialog",props:{isOpen:{type:Boolean,default:!1},title:{type:String,required:!1,default:""},onSubmit:{type:Function,required:!0},renameText:{type:String,required:!1,default:""}},emits:["onClose"],setup(t,{emit:e}){const c=t,d=O("media"),l=D(c.renameText),r=b(()=>d.getters(S.IS_SUBMITTING)),s=async()=>{await c.onSubmit(l.value),p()},p=()=>{e("onClose"),l.value=""};return(f,_)=>{const n=m("v-card-title"),o=m("VDivider"),u=m("VTextField"),h=m("v-btn"),k=m("v-card"),C=m("v-dialog");return i(),I(C,{"model-value":t.isOpen,width:"400",persistent:""},{default:y(()=>[a(k,null,{default:y(()=>[a(n,null,{default:y(()=>[L(V(t.title),1)]),_:1}),a(o),v("div",P,[a(u,{variant:"outlined",modelValue:l.value,"onUpdate:modelValue":_[0]||(_[0]=g=>l.value=g)},null,8,["modelValue"]),v("div",z,[a(h,{class:"mr-2",onClick:p,disabled:r.value},{default:y(()=>[L(" Cancel ")]),_:1},8,["disabled"]),a(h,{color:"blue",onClick:s,loading:r.value},{default:y(()=>[L(" Save ")]),_:1},8,["loading"])])])]),_:1})]),_:1},8,["model-value"])}}}),G=R({__name:"MediaItemAction",props:{activator:{type:String},mediaItem:{type:Object,required:!0}},setup(t){var f;const e=t,c=O("media"),d=[{title:"Open",type:"OPEN",disabled:!((f=e.mediaItem)!=null&&f.children)},{title:"Rename",type:"RENAME"},{title:"Delete",type:"DELETE"}],l=D(!1),r=_=>{var n,o;switch(_.type){case"OPEN":(n=e.mediaItem)!=null&&n.children&&c.dispatch(x.HANDLE_SELECT_DIRECTORY,e.mediaItem);break;case"RENAME":l.value=!0;break;case"DELETE":{const u={path:e.mediaItem.path,isFolder:(o=e.mediaItem)!=null&&o.children?1:0};c.dispatch(x.DELETE_FILE_OR_FOLDER,u);break}}},s=b(()=>{var o;if((o=e.mediaItem)!=null&&o.children)return{name:e.mediaItem.title};const _=e.mediaItem.title,n=_.lastIndexOf(".");if(n!==-1){const u=_.substring(0,n),h=_.substring(n+1);return{name:u,extension:h}}return null}),p=async _=>{var u;if(!_)return;const n=e.mediaItem.path,o=n.lastIndexOf("/");if(o!==-1){const h=n.substring(0,o),k={oldName:e.mediaItem.path,newName:`${h}/${_}${(u=s.value)!=null&&u.extension?`.${s.value.extension}`:""}`};if(k.oldName===k.newName)return;await c.dispatch(x.RENAME_FILE_OF_FOLDER,k)}};return(_,n)=>{var C;const o=m("v-list-item-title"),u=m("v-list-item"),h=m("v-list"),k=m("v-menu");return i(),E(T,null,[a(k,{transition:"slide-y-transition",activator:`#menu_${t.activator}`},{default:y(()=>[a(h,null,{default:y(()=>[(i(),E(T,null,F(d,(g,w)=>a(u,{key:w,value:w,onClick:()=>r(g),disabled:g==null?void 0:g.disabled},{default:y(()=>[a(o,null,{default:y(()=>[L(V(g.title),1)]),_:2},1024)]),_:2},1032,["value","onClick","disabled"])),64))]),_:1})]),_:1},8,["activator"]),l.value?(i(),I(N,{key:0,title:"Rename","rename-text":(C=s.value)==null?void 0:C.name,"is-open":l.value,"on-submit":p,onOnClose:n[0]||(n[0]=g=>l.value=!1)},null,8,["rename-text","is-open"])):$("",!0)],64)}}}),H=["id"],U={key:0},Y={class:"text-center break-all"},Z=R({__name:"MediaItem",props:{item:{type:Object,required:!0},isSelectMode:{type:Boolean,required:!1}},setup(t){const e=t,c=D(!1),d=O("media"),l=b(()=>d.getters(S.GET_SELECTED_FILES));return q(c,r=>{var f;const s=new Set(...Array(l.value)),p=(f=e.item)==null?void 0:f.url;p&&(r?s.add(p):s.delete(p),d.dispatch(x.HANDLE_SET_SELECTED_FILES,s))}),(r,s)=>{var n;const p=m("VIcon"),f=m("VImg"),_=m("v-checkbox");return i(),E(T,null,[v("div",{class:"w-[100px] ma-1 d-flex flex-column align-center cursor-pointer position-relative h-fit",id:`menu_${t.item.key}`},[v("div",null,[t.item.children?(i(),I(p,{key:0,icon:"mdi-folder",size:"75"})):(n=t.item)!=null&&n.isImage?(i(),I(f,{key:1,src:t.item.url,width:"75",height:"75"},null,8,["src"])):(i(),I(p,{key:2,icon:"mdi-file",size:"75"}))]),t.isSelectMode?(i(),E("div",U,[a(_,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=o=>c.value=o),onClick:s[1]||(s[1]=o=>{o.stopPropagation()}),"hide-details":"",disabled:!t.item.url},null,8,["modelValue","disabled"])])):$("",!0),v("div",Y,V(t.item.title),1)],8,H),a(G,{activator:t.item.key,"media-item":t.item},null,8,["activator","media-item"])],64)}}}),J={class:"border rounded-sm d-flex align-center"},K={class:""},Q={class:"pl-2 d-flex align-center"},W=R({__name:"MediaHeader",setup(t){const e=O("media");b(()=>e.getters(S.DIRECTORIES_REAL));const c=b(()=>{const l=[],r=e.getters(S.SELECTED_DIRECTORIES);return r?l.push(...r.path.split("/").map(s=>({title:s,disabled:!1}))):l.push({title:"uploads",disabled:!1}),l}),d=()=>{e.dispatch(x.HANDLE_SELECT_DIRECTORY)};return(l,r)=>{const s=m("VBtn"),p=m("VDivider"),f=m("v-breadcrumbs");return i(),E("div",J,[v("div",K,[a(s,{disabled:!c.value.length,rounded:"0",variant:"text",icon:"mdi-home-outline",onClick:d},null,8,["disabled"])]),a(p,{vertical:""}),v("div",Q,[a(f,{items:c.value,class:"py-1"},null,8,["items"])])])}}}),X={class:"text ml-1"},ee=R({__name:"TreeItem",props:{treeItem:{type:Object,required:!0},onClick:{type:Function,required:!1}},setup(t){const e=t,c=D(!1),d=()=>{var l,r;c.value=!c.value,(l=e.treeItem)!=null&&l.children&&((r=e.onClick)==null||r.call(e,e.treeItem))};return(l,r)=>{var p,f,_,n;const s=m("VIcon");return i(),E("li",null,[v("div",{onClick:d,class:"cursor-pointer d-flex item-center py-1"},[(p=t.treeItem)!=null&&p.children?(i(),E(T,{key:0},[c.value?(i(),I(s,{key:0,icon:"mdi-folder-open-outline"})):(i(),I(s,{key:1,icon:"mdi-folder-outline"}))],64)):(i(),I(s,{key:1,icon:"mdi-file-outline"})),v("span",X,V(t.treeItem.title),1)]),v("div",{class:B({hidden:!c.value})},[((_=(f=t.treeItem)==null?void 0:f.children)==null?void 0:_.length)>0?(i(),I(A,{key:0,items:((n=t.treeItem)==null?void 0:n.children)??[],"on-click-item":t.onClick},null,8,["items","on-click-item"])):$("",!0)],2)])}}});const te=M(ee,[["__scopeId","data-v-6a58e909"]]),ne={class:"ml-4 tree-list"},ie=R({__name:"TreeView",props:{items:{type:Array,required:!0},onClickItem:{type:Function,required:!1}},setup(t){return(e,c)=>(i(),E("div",null,[v("ul",ne,[(i(!0),E(T,null,F(t.items,d=>(i(),I(te,{key:d.key,"tree-item":d,"on-click":t.onClickItem},null,8,["tree-item","on-click"]))),128))])]))}});const A=M(ie,[["__scopeId","data-v-6936ef88"]]),le={class:"wrapper"},se=R({__name:"MediaSidebar",setup(t){const e=O("media"),c=b(()=>e.getters(S.DIRECTORIES_REAL)),d=l=>{e.dispatch(x.HANDLE_SELECT_DIRECTORY,l)};return(l,r)=>(i(),E("div",le,[a(A,{items:c.value,"on-click-item":d},null,8,["items"])]))}});const oe=M(se,[["__scopeId","data-v-73e0dc47"]]),ae={class:"d-flex justify-space-between mb-3"},ce=v("div",{class:"text-h5"},"Manage folders",-1),de={key:0,class:"text-center my-16"},re={class:"d-flex flex-wrap"},ue={key:0,class:"d-flex justify-center flex-fill py-4"},me={class:"d-flex flex-column justify-center align-center"},ve=R({__name:"MediaLayout",props:{isSelectMode:{type:Boolean,required:!1}},setup(t){const e=O("media"),c=b(()=>e.getters(S.DIRECTORIES)),d=b(()=>e.getters(S.SELECTED_DIRECTORIES)),l=b(()=>e.getters(S.IS_LOADING)),r=D(!1),s=D(null);j(()=>{e.dispatch(x.GET_DIRECTORIES)});const p=async n=>{var u;const o={path:((u=d==null?void 0:d.value)==null?void 0:u.path)??"uploads",name:n};await e.dispatch(x.CREATE_FOLDER,o)},f=n=>{var u;const o={filePath:((u=d==null?void 0:d.value)==null?void 0:u.path)??"uploads",file:n.target.files[0]};e.dispatch(x.UPLOAD_FILE,o)},_=()=>{var n;(n=s.value)==null||n.click()};return(n,o)=>{const u=m("VIcon"),h=m("v-btn"),k=m("v-progress-circular");return i(),E(T,null,[v("div",ae,[ce,v("div",null,[a(h,{title:"File upload",class:"mr-2",onClick:_},{default:y(()=>[a(u,{icon:"mdi-file-upload-outline"})]),_:1}),a(h,{title:"Create folder",onClick:o[0]||(o[0]=C=>r.value=!0)},{default:y(()=>[a(u,{icon:"mdi-folder-plus-outline"})]),_:1}),v("input",{hidden:"",type:"file",onChange:f,ref_key:"fileRef",ref:s},null,544)])]),l.value?(i(),E("div",de,[a(k,{size:50,indeterminate:""})])):(i(),E(T,{key:1},[a(W),v("div",re,[a(oe),c.value.length?(i(!0),E(T,{key:1},F(c.value,C=>(i(),I(Z,{key:C.key,item:C,"is-select-mode":t.isSelectMode},null,8,["item","is-select-mode"]))),128)):(i(),E("div",ue,[v("div",me,[a(u,{icon:"mdi-folder-outline",size:"50"}),L(" Folder is empty ")])]))])],64)),a(N,{title:"Create folder","is-open":r.value,"on-submit":p,onOnClose:o[1]||(o[1]=C=>r.value=!1)},null,8,["is-open"])],64)}}});export{ve as _};
